<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Results</title>
    <script type="module">
        import { confetti } from "https://cdn.jsdelivr.net/npm/tsparticles-confetti/+esm";

        const end = Date.now() + 45 * 1000;

        // go Buckeyes!
        const colors = ["#bb0000", "#ffffff"];

        const run = () => {
        (function frame() {
            confetti({
            particleCount: 2,
            angle: 60,
            spread: 55,
            origin: { x: 0 },
            colors: colors
            });

            confetti({
            particleCount: 2,
            angle: 120,
            spread: 55,
            origin: { x: 1 },
            colors: colors
            });

            if (Date.now() < end) {
            requestAnimationFrame(frame);
            }
        })();
        };



        run();
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poetsen+One&display=swap" rel="stylesheet">
        
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="./modstyle.css">
    <script src="worker.js"></script>
    <style>
        /* General Reset */
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }

        /* Body Background */
        body {
            /* background: url('./images/plain-bg.webp') no-repeat center center fixed; */
            background: url('./images/RulesBG.webp') no-repeat center center fixed;
            background-size: cover;
            overflow: hidden;
            font-family: Arial, Helvetica, sans-serif;
            font-family: "Poetsen One", sans-serif;
            font-weight: 400;
            font-style: normal;
        }

        /* Main Container */
        .main {
            width: 100%;
            height: 100vh;
        }

        /* Navigation Bar */
        .nav {
            display: flex;
            justify-content: space-between;
            padding: 2% 5%;
        }

        .nav img {
            width: 12%;
        }

        /* Result Div */
        .resultDiv {
            display: flex;
            width: 100%;
            justify-content: center;
            position: relative;
        }

        .resultDiv img {
            width: 70%;
            height: auto;
        }

        
        /* New Effect Styling */
        .con {
            position: absolute;
            top: 50%;
            left: 56%;
            transform: translate(-50%, -50%);
            text-align: center;
            width: 70%;
        }

        /* List Container */
        .list-container {
            margin: 2% 0;
        }

        .skew-effect {
            display: inline-block;
            height: 3.5rem; /* Equivalent to 50px */
            width: 2.9%; /* Equivalent to 40px assuming 1366px screen width */
            transform: skew(30deg);
        }

        .filler {
            display: inline-block;
            /* background-color: #974ab6; */
            background-color: rgb(78 198 207);
            height: 3.5rem; /* Equivalent to 50px */
            width: 0.7%; /* Equivalent to 10px assuming 1366px screen width */
            position: relative;
            left: -11.7%; /* Equivalent to -160px assuming 1366px screen width */
        }

        .rank-container {
            /* background-color: #974ab6; */
            background-color: rgb(78 198 207);
            width: 23%; /* Equivalent to 250px assuming 1366px screen width */
            position: relative;
            left: -11.7%; /* Equivalent to -160px assuming 1366px screen width */
        }

        .rank, .rank1 {
            display: inline-block;
            position: relative;
            left: -25.6%; /* Equivalent to -350px assuming 1366px screen width */
            top: -1rem; /* Equivalent to -16px */
            color: #ffffff;
            text-transform: uppercase;
            font-weight: 800;
            font-size: 1.5rem; /* Equivalent to 24px */
        }

        .name-container, .name-container1 {
            display: inline-block;
            background-color: white;
            height: 0;
            width: 0;
            animation-name: extender;
            animation-duration: 1.5s;
            animation-fill-mode: forwards;
            position: relative;
            left: -6%; /* Equivalent to -18px assuming 1366px screen width */
        }

        #first-place > .name-container, 
        #first-place > .name-container1 {
            animation-delay: 0.85s;
        }

        #second-place > .name-container,
        #second-place > .name-container1 {
            animation-delay: 0.825s;
        }

        #third-place > .name-container, 
        #third-place > .name-container1 {
            animation-delay: 0.8s;
        }

        #fourth-place > .name-container, 
        #fourth-place > .name-container1 {
            animation-delay: 0.775s;
        }

        #fifth-place > .name-container, 
        #fifth-place > .name-container1 {
            animation-delay: 0.75s;
        }

        .participant-name {
            display: inline-block;
            transform: skew(0deg, 0deg);
            text-transform: uppercase;
            font-weight: 800;
            color: black;
            position: relative;
            top: -1rem; /* Equivalent to -16px */
            left: -22.7%; /* Equivalent to -310px assuming 1366px screen width */
            font-size: 1.5rem; /* Equivalent to 24px */
            opacity: 0;
            animation-delay: 2s;
            animation-name: namefadein;
            animation-duration: 1s;
            animation-fill-mode: forwards;
        }

        .participant-name1 {
            display: inline-block;
            transform: skew(0deg, 0deg);
            text-transform: uppercase;
            font-weight: 800;
            color: black;
            position: relative;
            top: -1rem; /* Equivalent to -16px */
            left: -21%; /* Equivalent to -260px assuming 1366px screen width */
            font-size: 1.5rem; /* Equivalent to 24px */
            opacity: 0;
            animation-delay: 2s;
            animation-name: namefadein;
            animation-duration: 1s;
            animation-fill-mode: forwards;
        }

        @media only screen and (max-width: 1366px) {
            .participant-name1 {
                left: -19%;
            }

            .participant-name {
                left: -23%;
            }
        }

        /* Popper Animation */
        @keyframes popper {
            from { top: 700px; }
            to { top: 0; }
        }

        @keyframes popper2 {
            from { top: 700px; }
            to { top: -10px; }
        }

        @keyframes extender {
            from {
                width: 0px;
                height: 3.5rem; /* Equivalent to 50px */
            }
            to {
                width: 26%; /* Equivalent to 300px assuming 1366px screen width */
                height: 3.5rem; /* Equivalent to 50px */
                border: 1px solid #c3c3c3;
            }
        }

        /* Name Fade-in Animation */
        @keyframes namefadein {
            from { opacity: 0.2; }
            to { opacity: 1; }
        }

        .trophy_img{
            width: 1.8rem !important;
            margin-left: -38px;
            margin-right: 22px;
        }
    </style>
    
</head>
<body>
    <audio src="../sound/Background-Music.mp3"></audio>
    <div class="main" style="margin-top: 4rem;">  
        <!-- <div class="nav">
            <img src="./images/GSK Logo.png" alt="">
            <img src="./images/Augmentin Logo.png" alt="">
        </div> -->
        


 <!-- FOR SoundðŸ‘‡ and Back -->
 <div class="buttonsoundalign"  style="bottom: 50%;">
        
    <button onclick="back()" class="soundleft" >back</button>
    
    <button id="volumeup" class="soundright" onclick="backSound()" style="display: block;">  <i class="fas fa-volume-xmark"></i></button>
    <button id="volumedown" class="soundright" onclick="backSound2()" style="display: none;">  <i class="fas fa-volume-up"></i></button>
    
</div>

<!-- FOR Soundâ˜and Back  -->
        <div class="resultDiv">

            <div style=" position: absolute;
    top: 5rem;color: #ffffff;
    
    font-weight: 800;
    font-size: 2rem;
">Final Results</div>
           
            <img src="./images/Board.png" alt="">

            <div class="con" style="width: 70%; text-align: center;">
                <div class="list-container" id="first-place" style="width: 100%;">
                    
                    <div class="skew-effect name-container1" ></div>
                    <div class="participant-name1" >Tables</div>
                    <div class="skew-effect rank-container" ></div>
                    <div class="skew-effect filler"  ></div>
                    <div class="skew-effect filler" ></div>
                    <div class="rank1"  >Scores</div>
                    
                    <!-- <div class="list-container" id="results" style="text-align: center;">
                    </div> -->
                </div>
                
            </div>
        </div>

        <!-- <div class="forNextBtn" style="width: 100%; height: auto; position: relative; text-align: center;">
            <a href="./main.html">
                <img src="./images/Option Board.png" style="display: block;" alt="">
                <div class="text" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                    <p>NEXT</p>
                </div>
            </a>
        </div> -->

        <div class="forBtn">
            <!-- <button id="showListButton" class="btnBackground " onclick="changeScreen()" >NEXT</button> -->
            <button id="showListButton" class="btnBackground " onclick="changeScreen()" >End Game</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const resultDiv = document.getElementById('first-place');

            // Check if localStorage is supported by the browser
            if (typeof(Storage) !== "undefined") {
                // Retrieve all keys from localStorage
                const keys = Object.keys(localStorage);

                // Initialize objects to store scores by table number for Game1, Game2, and Game3
                const scoresGame1 = {};
                const scoresGame2 = {};
                const scoresGame3 = {};

                // Iterate over each key and process items that start with "Game1", "Game2", or "Game3"
                keys.forEach(key => {
                    if (key.startsWith("Game1")) {
                        // Extract table number and score from the item
                        const [ , , tableNumber ] = key.split(' ');
                        const score = parseInt(localStorage.getItem(key));
                        
                        // Add the score to the corresponding table number in scoresGame1
                        if (scoresGame1[tableNumber]) {
                            scoresGame1[tableNumber] += score;
                        } else {
                            scoresGame1[tableNumber] = score;
                        }
                    } else if (key.startsWith("Game2")) {
                        // Extract table number and score from the item
                        const [ , , tableNumber ] = key.split(' ');
                        const score = parseInt(localStorage.getItem(key));
                        
                        // Add the score to the corresponding table number in scoresGame2
                        if (scoresGame2[tableNumber]) {
                            scoresGame2[tableNumber] += score;
                        } else {
                            scoresGame2[tableNumber] = score;
                        }
                    } else if (key.startsWith("Game3")) {
                        // Extract table number and score from the item
                        const [ , , tableNumber ] = key.split(' ');
                        const score = parseInt(localStorage.getItem(key));
                        
                        // Add the score to the corresponding table number in scoresGame3
                        if (scoresGame3[tableNumber]) {
                            scoresGame3[tableNumber] += score;
                        } else {
                            scoresGame3[tableNumber] = score;
                        }
                    }
                });

                // Initialize an array to store the total scores by table number
                const totalScores = [];

                // Sum scores from Game1, Game2, and Game3 for each table number
                const allTableNumbers = new Set([...Object.keys(scoresGame1), ...Object.keys(scoresGame2), ...Object.keys(scoresGame3)]);
                allTableNumbers.forEach(tableNumber => {
                    const totalScore = (scoresGame1[tableNumber] || 0) + (scoresGame2[tableNumber] || 0) + (scoresGame3[tableNumber] || 0);
                    totalScores.push({ tableNumber: parseInt(tableNumber), totalScore: totalScore });
                });

                // Sort the total scores in descending order by table number and total score
                totalScores.sort((a, b) => b.totalScore - a.totalScore || b.tableNumber - a.tableNumber);

                // Construct HTML content based on sorted scores
                totalScores.slice(0, 5).forEach((item, index) => {
                    let listItem = document.createElement('div');
                if(index === 0)
                {
                    listItem.className = 'list-container';
                    
                    listItem.innerHTML = `
                        <div class="skew-effect name-container"></div>
                        <div style="color: gold;" class="participant-name"><img class="trophy_img" src="./images/trophy.png" alt="Trophy" class="trophy-icon">Table ${item.tableNumber} </div>
                        <div class="skew-effect rank-container" style="left: -13%;"></div>
                        <div class="skew-effect filler"style="left: -13%;" ></div>
                        <div class="skew-effect filler" style="left: -13%;"></div>
                        <div class="rank" > ${item.totalScore}</div>

                       
                        
                    `;
                }else{
                    listItem.className = 'list-container';
                    
                    listItem.innerHTML = `
                        <div class="skew-effect name-container"></div>
                        <div class="participant-name"> Table ${item.tableNumber} </div>

                        <div class="skew-effect rank-container"></div>
                        <div class="skew-effect filler"></div>
                        <div class="skew-effect filler"></div>
                        <div class="rank"> ${item.totalScore}</div>

                       
                        
                    `;
                }
                
                    resultDiv.appendChild(listItem);
                });
            } else {
                console.log("Sorry, your browser does not support Web Storage...");
            }
        });


        function changeScreen() {

            // window.location.href="./endScreens/endScreen1.html";
            window.location.href="./main.html";
        }

        var backgroundAudio = new Audio('./sound/aplause.mpeg');
  
    
  // backgroundAudio.play();
  backgroundAudio.loop = true; // Loop the audio
  
  var volumeup = document.getElementById('volumeup'); // Corrected ID
  var volumedown = document.getElementById('volumedown'); // Corrected ID
  volumedown.style.display = "none";
  
  function backSound() {
      console.log("sound play");
      backgroundAudio.play();
      volumeup.style.display = 'none'; // Change the display to none when audio is playing
      volumedown.style.display = 'block'; // Change the display to block when audio is playing
  }
  
  function backSound2() {
      console.log("sound pause");
      backgroundAudio.pause();
      volumeup.style.display = 'block'; // Change the display to block when audio is paused
      volumedown.style.display = 'none'; // Change the display to none when audio is paused
  }
  function back(){
            // window.location.href = "./Game3/result3.html"
            window.location.href = "main.html"
        }
        </script>

</body>
</html>
